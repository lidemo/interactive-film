<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Branching Narrative</title>
    <link rel="stylesheet" href="main.css">
</head>
<body>
    <h1>Interactive Film: The Choice</h1>
    
    <div class="container">
        <div class="video-container">
            <video id="videoPlayer" controls>
                <source src="" type="video/mp4">
                Your browser does not support the video element.
            </video>
        </div>
        
        <div id="choiceContainer" class="choice-container">
            <!-- Choices will be dynamically added here -->
        </div>
        
        <button id="logToggle" class="log-toggle">Show Session Log</button>
        
        <div id="sessionLog" class="session-log">
            <h3>Your Journey</h3>
            <div id="logEntries"></div>
        </div>
    </div>

    <script>
        // Story structure defined as a graph
        const storyGraph = {
            "intro": {
                videoSrc: "files/1.mp4",
                choices: [
                    {
                        text: "Take the blue pill",
                        nextNode: "bluePill"
                    },
                    {
                        text: "Take the red pill",
                        nextNode: "redPill"
                    }
                ]
            },
            "bluePill": {
                videoSrc: "files/2.mp4",
                choices: [
                    {
                        text: "Go home",
                        nextNode: "blueHome"
                    },
                    {
                        text: "Go to work",
                        nextNode: "blueWork"
                    }
                ]
            },
            "redPill": {
                videoSrc: "files/3.mp4",
                choices: [
                    {
                        text: "Fight",
                        nextNode: "redFight"
                    },
                    {
                        text: "Run",
                        nextNode: "redRun"
                    }
                ]
            },
            "blueHome": {
                videoSrc: "https://example.com/blue-home.mp4",
                choices: [
                    {
                        text: "Call friend",
                        nextNode: "blueHomeCall"
                    },
                    {
                        text: "Go to sleep",
                        nextNode: "blueHomeSleep"
                    }
                ]
            },
            "blueWork": {
                videoSrc: "https://example.com/blue-work.mp4",
                // Example of an ending node with no choices
                ending: "You lived a normal life, never knowing what could have been."
            },
            "redFight": {
                videoSrc: "https://example.com/red-fight.mp4",
                choices: [
                    {
                        text: "Use weapon",
                        nextNode: "redFightWeapon"
                    },
                    {
                        text: "Hand-to-hand",
                        nextNode: "redFightHands"
                    }
                ]
            },
            "redRun": {
                videoSrc: "https://example.com/red-run.mp4",
                ending: "You escaped, but they will always be looking for you."
            },
            "blueHomeCall": {
                videoSrc: "https://example.com/blue-home-call.mp4",
                ending: "You shared your strange experience with a friend, who thought you were crazy."
            },
            "blueHomeSleep": {
                videoSrc: "https://example.com/blue-home-sleep.mp4",
                ending: "You slept soundly, forgetting everything by morning."
            },
            "redFightWeapon": {
                videoSrc: "https://example.com/red-fight-weapon.mp4",
                ending: "You defeated them with the weapon, becoming a legend."
            },
            "redFightHands": {
                videoSrc: "https://example.com/red-fight-hands.mp4",
                ending: "You were outmatched, but gained their respect."
            }
        };

        // Session log to track user choices
        let sessionLog = [];
        let currentNode = "intro";
        
        // DOM elements
        const videoPlayer = document.getElementById("videoPlayer");
        const choiceContainer = document.getElementById("choiceContainer");
        const logToggle = document.getElementById("logToggle");
        const sessionLogDiv = document.getElementById("sessionLog");
        const logEntries = document.getElementById("logEntries");
        
        // Initialize the experience
        loadNode(currentNode);
        
        // Load a story node
        function loadNode(nodeId) {
            const node = storyGraph[nodeId];
            
            // Update video source
            videoPlayer.src = node.videoSrc;
            videoPlayer.load();
            
            // Play video
            videoPlayer.play();
            
            // Hide choices during video playback
            choiceContainer.style.display = "none";
            
            // When video ends, show choices or ending
            videoPlayer.onended = function() {
                if (node.ending) {
                    // This is an ending node
                    showEnding(node.ending);
                } else {
                    // Show choices for this node
                    showChoices(node.choices);
                }
            };
            
            // Add to session log
            addToSessionLog(nodeId);
        }
        
        // Show choices for the current node
        function showChoices(choices) {
            // Clear previous choices
            choiceContainer.innerHTML = "";
            
            // Add new choice buttons
            choices.forEach(choice => {
                const button = document.createElement("button");
                button.className = "choice-btn";
                button.textContent = choice.text;
                button.addEventListener("click", () => {
                    choiceContainer.style.display = "none";
                    loadNode(choice.nextNode);
                });
                choiceContainer.appendChild(button);
            });
            
            // Display choices
            choiceContainer.style.display = "flex";
        }
        
        // Show ending text
        function showEnding(endingText) {
            choiceContainer.innerHTML = "";
            
            const endingDiv = document.createElement("div");
            endingDiv.style.textAlign = "center";
            endingDiv.style.padding = "20px";
            endingDiv.style.backgroundColor = "#333";
            endingDiv.style.borderRadius = "4px";
            
            const endingHeader = document.createElement("h2");
            endingHeader.textContent = "The End";
            endingDiv.appendChild(endingHeader);
            
            const endingPara = document.createElement("p");
            endingPara.textContent = endingText;
            endingDiv.appendChild(endingPara);
            
            const replayButton = document.createElement("button");
            replayButton.className = "choice-btn";
            replayButton.textContent = "Play Again";
            replayButton.addEventListener("click", () => {
                currentNode = "intro";
                loadNode(currentNode);
            });
            endingDiv.appendChild(replayButton);
            
            choiceContainer.appendChild(endingDiv);
            choiceContainer.style.display = "block";
            
            // Log the ending
            addToSessionLog("ENDING: " + endingText);
        }
        
        // Add a node to the session log
        function addToSessionLog(nodeId) {
            const timestamp = new Date().toLocaleTimeString();
            let nodeName = nodeId;
            
            // Make the node name more human-readable
            if (nodeId === "intro") {
                nodeName = "Started the story";
            } else if (nodeId.startsWith("blue")) {
                nodeName = "Chose the blue path: " + nodeId.replace("blue", "");
            } else if (nodeId.startsWith("red")) {
                nodeName = "Chose the red path: " + nodeId.replace("red", "");
            }
            
            // Add to session log
            sessionLog.push({
                timestamp: timestamp,
                node: nodeName
            });
            
            // Update session log display
            updateSessionLogDisplay();
        }
        
        // Update the session log display
        function updateSessionLogDisplay() {
            logEntries.innerHTML = "";
            
            sessionLog.forEach(entry => {
                const logEntry = document.createElement("div");
                logEntry.className = "log-entry";
                logEntry.innerHTML = `<strong>${entry.timestamp}</strong>: ${entry.node}`;
                logEntries.appendChild(logEntry);
            });
        }
        
        // Toggle session log visibility
        logToggle.addEventListener("click", () => {
            if (sessionLogDiv.style.display === "none" || !sessionLogDiv.style.display) {
                sessionLogDiv.style.display = "block";
                logToggle.textContent = "Hide Session Log";
            } else {
                sessionLogDiv.style.display = "none";
                logToggle.textContent = "Show Session Log";
            }
        });
    </script>
</body>
</html>